import{a as p,c as v,x as D,m as j,j as B,e as g,b as e,t as k,g as C,v as E,h as F,u as h,F as V,y as z,z as O,k as Y,A as q,n as G,p as L,f as J,B as Q,o as X,T as Z,s as ee,d as U}from"./index.3788fcc5.js";import"./HackTimer.min.640bcee2.js";import{f as $}from"./useFormatNumber.010f5aee.js";function te(){let c=new Date,a=c.getFullYear(),n=$(c.getMonth()+1),l=$(c.getDate()),u=$(c.getHours()),f=$(c.getMinutes()),_=$(c.getSeconds());return`${a}-${n}-${l} ${u}:${f}:${_}`}function I(c){let a=document.body,n,l;if(document.createRange&&window.getSelection){n=document.createRange(),l=window.getSelection(),l.removeAllRanges();try{n.selectNodeContents(c),l.addRange(n)}catch{n.selectNode(c),l.addRange(n)}}else a.createTextRange&&(n=a.createTextRange(),n.moveToElementText(c),n.select());document.execCommand("Copy"),document.getSelection().removeAllRanges()}const oe={key:0,class:"copyed-msg"},ae={__name:"WorkingHoursCalculationNotice",props:{isShowCopyed:Boolean},setup(c){const a=c;return(n,l)=>a.isShowCopyed?(p(),v("div",oe,"\u5DF2\u8907\u88FD\u5230\u526A\u8CBC\u7C3F")):D("",!0)}};var ne="/joy-tools/assets/cuckoo-clock-trimmed.33833c85.mp3";const se={class:"container"},le={class:"row"},re={class:"col-12"},ie={class:"upper-inner"},de={id:"js-timer",class:"timer-wrap"},ce={class:"timer-text"},ue={class:"btn-wrap"},me=["data-type"],_e=["disabled"],pe={class:"group-wrap"},ve={class:"form-group"},be=e("label",{for:"chk-alert-sound"},"\u5E03\u7A40\u63D0\u793A\u97F3 (\u6BCF\u5C0F\u6642\u64AD\u653E)",-1),he=e("source",{src:ne,type:"audio/mpeg"},null,-1),ge=[he],fe={class:"form-group"},ye=e("label",{for:"chk-hour"},"\u9B54\u6CD5\u6642\u6578: \u6642\u6578\u9032\u4F4D\u70BA0.25\u7684\u500D\u6578 (\u704C\u6C3410\u5206\u9418\u4EE5\u5167)",-1),ke={class:"form-group"},we=e("label",{for:"fragmentary-mode"},"\u96F6\u788E\u6642\u9593\u6A21\u5F0F (\u9B54\u6CD5\u6642\u6578\u50C5\u97FF\u61C9\u5728\u52A0\u7E3D\u6642\u9593)",-1),$e={class:"modal fade",id:"staticBackdrop","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"staticBackdropLabel","aria-hidden":"true"},Me={class:"modal-dialog modal-dialog-centered"},xe={class:"modal-content"},Ce=e("div",{class:"modal-header"},[e("h1",{class:"modal-title fs-5",id:"staticBackdropLabel"},"\u65B0\u589E\u7D00\u9304"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Te={class:"modal-body"},Re={class:"row mb-2"},De={class:"col-12"},Se=e("label",{for:"start-time",class:"me-2"},"\u958B\u59CB\u6642\u9593",-1),He={class:"col-12"},Fe=e("label",{for:"end-time",class:"mt-2 me-2"},"\u7D50\u675F\u6642\u9593",-1),Ae={class:"col-12"},Ne=e("label",{for:"note",class:"mt-2 me-2"},"\u5099\u8A3B\u4E8B\u9805",-1),Be={class:"modal-footer"},Ee={key:0,class:"text-danger"},Ue=["disabled"],Ve=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"\u53D6\u6D88",-1),We={__name:"WorkingHoursCalculationHeader",props:j({timerData:Object},{isFragmentaryMode:{},isFragmentaryModeModifiers:{},isAlertSound:{},isAlertSoundModifiers:{},isHoursMagic:{},isHoursMagicModifiers:{}}),emits:j(["eventWorkRecord","eventAddNewRecord","eventCopyTableData"],["update:isFragmentaryMode","update:isAlertSound","update:isHoursMagic"]),setup(c,{expose:a,emit:n}){const l=c,u=n,f=B(c,"isFragmentaryMode"),_=B(c,"isAlertSound"),M=B(c,"isHoursMagic");let b=g(null);a({alertPlayer:b});let d=g({start:"",end:"",note:"\u81E8\u6642\u7D00\u9304"});function T(){u("eventWorkRecord")}function x(){u("eventAddNewRecord",d.value)}function S(){u("eventCopyTableData")}function r(){!_.value||(b.value.pause(),console.log("\u6253\u52FE"))}function y(){b.value.play(),console.log("\u8A66\u807D\u63D0\u793A\u97F3")}function s(){b.value.pause(),console.log("\u505C\u6B62\u64AD\u653E\u63D0\u793A\u97F3")}return(w,t)=>(p(),v(V,null,[e("section",null,[e("div",se,[e("div",le,[e("div",re,[e("div",ie,[e("div",de,[e("span",ce,k(l.timerData.timer_text),1)]),e("div",ue,[e("button",{"data-type":l.timerData.timer_btn_type,onClick:t[0]||(t[0]=o=>T()),class:"text-btn"},k(l.timerData.timer_btn_text),9,me),e("button",{class:"icon-btn add","data-bs-toggle":"modal","data-bs-target":"#staticBackdrop",disabled:l.timerData.timer_btn_type=="end"},null,8,_e),e("button",{onClick:t[1]||(t[1]=o=>S()),class:"icon-btn copy-all","data-bs-container":"body","data-bs-toggle":"tooltip","data-bs-placement":"right",title:"\u8907\u88FD\u8868\u683C\u5230\u526A\u8CBC\u7C3F"})]),e("div",pe,[e("fieldset",ve,[C(e("input",{type:"checkbox",name:"chk-alert-sound",id:"chk-alert-sound","onUpdate:modelValue":t[2]||(t[2]=o=>_.value=o),onChange:t[3]||(t[3]=o=>r())},null,544),[[E,_.value]]),be,e("button",{onClick:t[4]||(t[4]=o=>y()),class:"icon-btn play","data-bs-container":"body","data-bs-toggle":"tooltip","data-bs-placement":"top",title:"\u8A66\u807D"}),e("button",{onClick:t[5]||(t[5]=o=>s()),class:"icon-btn pause","data-bs-container":"body","data-bs-toggle":"tooltip","data-bs-placement":"top",title:"\u505C\u6B62\u64AD\u653E"}),e("audio",{loop:"",preload:"auto",ref_key:"alertPlayer",ref:b,class:"audio-player"},ge,512)]),e("fieldset",fe,[C(e("input",{type:"checkbox",name:"chk-hour",id:"chk-hour","onUpdate:modelValue":t[6]||(t[6]=o=>M.value=o)},null,512),[[E,M.value]]),ye]),e("fieldset",ke,[C(e("input",{type:"checkbox",name:"fragmentary-mode",id:"fragmentary-mode","onUpdate:modelValue":t[7]||(t[7]=o=>f.value=o)},null,512),[[E,f.value]]),we])])])])])])]),e("div",$e,[e("div",Me,[e("div",xe,[Ce,e("div",Te,[e("div",Re,[e("div",De,[Se,C(e("input",{type:"datetime-local",name:"start-time",id:"start-time","onUpdate:modelValue":t[8]||(t[8]=o=>h(d).start=o)},null,512),[[F,h(d).start]])]),e("div",He,[Fe,C(e("input",{type:"datetime-local",name:"end-time",id:"end-time","onUpdate:modelValue":t[9]||(t[9]=o=>h(d).end=o)},null,512),[[F,h(d).end]])]),e("div",Ae,[Ne,C(e("input",{type:"text",name:"note",id:"note","onUpdate:modelValue":t[10]||(t[10]=o=>h(d).note=o)},null,512),[[F,h(d).note]])])])]),e("div",Be,[h(d).start>h(d).end?(p(),v("span",Ee,"\u958B\u59CB\u6642\u9593\u4E0D\u80FD\u5927\u65BC\u7D50\u675F\u6642\u9593")):D("",!0),e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal",onClick:t[11]||(t[11]=o=>x()),disabled:h(d).start==""||h(d).end==""||h(d).start>=h(d).end},"\u78BA\u5B9A",8,Ue),Ve])])])])],64))}},Pe={class:"container"},je={class:"row"},Ie={class:"col-12"},Le={class:"container-inner"},Ke={class:"table-wrap"},ze=e("thead",null,[e("th",{width:"20%"},"\u65E5\u671F"),e("th",{width:"25%"},"\u6642\u6BB5"),e("th",{width:"20%"},"\u6642\u6578"),e("th",null,"\u5099\u8A3B")],-1),Oe={key:0},Ye={key:0,class:"text-magic"},qe={key:1},Ge={class:"other-wrap"},Je={class:"remark-wrap"},Qe={key:0,class:"comment-text"},Xe=["data-id","onUpdate:modelValue","onBlur","onKeyup"],Ze={class:"operate-wrap"},et=["onClick"],tt=["onClick","disabled"],ot=e("td",null,"\u7E3D\u8A08",-1),at=e("td",null,null,-1),nt=e("td",null,null,-1),st={__name:"WorkingHoursCalculationBody",props:{record_arr:Array,total_hour:Number,isFragmentaryMode:Boolean,isHoursMagic:Boolean},emits:["eventEnableComment","eventRemoveRecord","eventCopyTrData"],setup(c,{expose:a,emit:n}){const l=c,u=n;let f=g(null);a({recordTable:f});let _=[];const M=function(r){r&&_.push({id:r.getAttribute("data-id"),el:r})};z(()=>{_=[]}),O(()=>{});function b(r,y){let s=r?r.split(" ")[0].split("-"):void 0,w=r?r.split(" ")[1].split(":"):void 0;switch(y){case"yyyy":return s?s[0]:"";case"mmdd":return s?`${s[1]}/${s[2]}`:"";case"hhmm":return w?`${w[0]}:${w[1]}`:""}}function d(r){return r?r.toFixed(2):"-"}function T(r){u("eventRemoveRecord",r)}function x(r,y){u("eventEnableComment",r,y),L(()=>{!y||_.forEach(s=>{s.id==r&&s.el.focus()})})}function S(r){u("eventCopyTrData",r)}return(r,y)=>(p(),v("section",null,[e("div",Pe,[e("div",je,[e("div",Ie,[e("div",Le,[e("div",Ke,[e("table",{ref_key:"recordTable",ref:f,class:"table-body table table-hover",width:"100%"},[ze,e("tbody",null,[(p(!0),v(V,null,Y(l.record_arr,(s,w)=>(p(),v("tr",{key:w},[e("td",null,k(b(s.r_start,"mmdd")),1),e("td",null,k(b(s.r_start,"hhmm"))+"~"+k(b(s.r_end,"hhmm")),1),e("td",null,[l.isFragmentaryMode?(p(),v("span",Oe,k(d(s.origin_hs)),1)):(p(),v(V,{key:1},[l.isHoursMagic?(p(),v("span",Ye,k(d(s.magic_hs)),1)):D("",!0),l.isHoursMagic?D("",!0):(p(),v("span",qe,k(d(s.origin_hs)),1))],64))]),e("td",null,[e("div",Ge,[e("div",Je,[s.comment_editable?D("",!0):(p(),v("span",Qe,k(s.r_comment),1)),s.comment_editable?C((p(),v("input",{key:1,type:"text",class:"comment-input","data-id":s.r_id,ref_for:!0,ref:M,"onUpdate:modelValue":t=>s.r_comment=t,onBlur:t=>x(s.r_id,!1),onKeyup:q(t=>x(s.r_id,!1),["enter"])},null,40,Xe)),[[F,s.r_comment]]):D("",!0)]),e("div",Ze,[e("button",{onClick:t=>x(s.r_id,!0),class:"icon-btn edit"},null,8,et),e("button",{onClick:t=>T(s.r_id),disabled:s.del_btn_enable,class:"icon-btn del"},null,8,tt),e("button",{onClick:y[0]||(y[0]=t=>S(t)),class:"icon-btn copy"})])])])]))),128)),e("tr",null,[ot,at,e("td",null,[e("span",{class:G({"text-magic":l.isFragmentaryMode})},k(d(l.total_hour)),3)]),nt])])],512)])])])])])]))}},lt={class:"container"},rt={class:"row"},it={class:"col-12"},dt={class:"working-hours-calculation"},_t={__name:"WorkingHoursCalculation",setup(c){const a=g([]),n=g({timer:null,timer_text:"00:00:00",timer_btn_type:"start",timer_btn_text:"Start"}),l=g(!1),u=g(!1),f=g(!1),_=g(!1),M=J(()=>(10/60).toFixed(3)),b=g(0);Q(()=>{let t=0,o=0,i=0;for(let m=0;m<a.value.length;m++)a.value[m].magic_hs&&(i+=a.value[m].magic_hs),a.value[m].origin_hs&&(o+=a.value[m].origin_hs);l.value?u.value?t=Math.ceil(o*4)/4:t=o:u.value?t=i:t=o,b.value=t});let d=g(null),T=g(null);X(()=>{new Z(document.body,{selector:"[data-bs-toggle='tooltip']"}),L(()=>{})});function x(){let t=te();switch(n.value.timer_btn_type){case"start":n.value.timer_text="00:00:01",n.value.timer=setInterval(()=>{let H=new Date(t),A=new Date,N=Math.ceil((A.getTime()-H.getTime())/1e3),K=$(Math.floor(N/60/60)%24),W=$(Math.floor(N/60)%60),P=$(Math.floor(N)%60);n.value.timer_text=`${K}:${W}:${P}`,console.log(n.value.timer_text),!!f.value&&W=="00"&&P=="00"&&(d.value.alertPlayer.play(),console.log("\u6574\u9EDE\u63D0\u793A\u97F3"))},1e3),n.value.timer_btn_text="Stop",n.value.timer_btn_type="end",a.value.push({r_id:a.value.length,r_start:t,r_end:void 0,r_comment:void 0,origin_hs:void 0,magic_hs:void 0,del_btn_enable:!0,comment_editable:!1});break;case"end":clearInterval(n.value.timer),n.value.timer=null,d.value.alertPlayer.pause(),console.log("\u95DC\u9589\u6574\u9EDE\u63D0\u793A\u97F3"),n.value.timer_text="00:00:00",n.value.timer_btn_text="Start",n.value.timer_btn_type="start";let i=(new Date(t).getTime()-new Date(a.value[a.value.length-1].r_start).getTime())/1e3/60/60,m=Math.ceil(i*4)/4,R=m-i<=M.value?m:i;a.value[a.value.length-1].r_end=t,a.value[a.value.length-1].del_btn_enable=!1,a.value[a.value.length-1].origin_hs=i,a.value[a.value.length-1].magic_hs=R;break}}function S(t){let o=t.start.replace("T"," "),i=t.end.replace("T"," "),m=t.note,R=(new Date(i).getTime()-new Date(o).getTime())/1e3/60/60,H=Math.ceil(R*4)/4,A=H-R<=M.value?H:R;a.value.push({r_id:a.value.length,r_start:o,r_end:i,r_comment:m,origin_hs:R,magic_hs:A,del_btn_enable:!1,comment_editable:!1})}function r(t){!window.confirm("\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u7B46\u7D00\u9304\u55CE\uFF1F")||(a.value=a.value.filter(i=>i.r_id!=t))}function y(t,o){for(let i of a.value)i.r_id==t&&(i.comment_editable=o)}function s(){I(T.value.recordTable),_.value=!0,setTimeout(()=>{_.value=!1},1e3)}function w(t){let i=t.target.parentNode.parentNode.parentNode.parentNode.cloneNode(!0),m=document.createElement("table");m.append(i),document.body.append(m),I(m),_.value=!0,setTimeout(()=>{_.value=!1},1e3),m.remove()}return ee(()=>{clearInterval(n.value.timer)}),(t,o)=>(p(),v("div",lt,[e("div",rt,[e("div",it,[e("section",dt,[U(ae,{isShowCopyed:_.value},null,8,["isShowCopyed"]),U(We,{ref_key:"headerRef",ref:d,timerData:n.value,isFragmentaryMode:l.value,"onUpdate:isFragmentaryMode":o[0]||(o[0]=i=>l.value=i),isHoursMagic:u.value,"onUpdate:isHoursMagic":o[1]||(o[1]=i=>u.value=i),isAlertSound:f.value,"onUpdate:isAlertSound":o[2]||(o[2]=i=>f.value=i),onEventWorkRecord:x,onEventCopyTableData:s,onEventAddNewRecord:S},null,8,["timerData","isFragmentaryMode","isHoursMagic","isAlertSound"]),U(st,{ref_key:"bodyRef",ref:T,record_arr:a.value,total_hour:b.value,isFragmentaryMode:l.value,isHoursMagic:u.value,onEventEnableComment:y,onEventRemoveRecord:r,onEventCopyTrData:w},null,8,["record_arr","total_hour","isFragmentaryMode","isHoursMagic"])])])])]))}};export{_t as default};
