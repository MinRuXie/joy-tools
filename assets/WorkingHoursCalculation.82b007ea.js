import{a as h,c as f,x,m as E,j as N,e as v,b as t,t as g,g as D,v as S,y as A,z as P,F as I,k as z,h as L,p as U,A as O,o as Y,T as q,s as G,d as T}from"./index.0210fc9e.js";import"./HackTimer.min.640bcee2.js";import{f as b}from"./useFormatNumber.15502b88.js";function J(){let i=new Date,o=i.getFullYear(),n=b(i.getMonth()+1),s=b(i.getDate()),c=b(i.getHours()),u=b(i.getMinutes()),d=b(i.getSeconds());return`${o}-${n}-${s} ${c}:${u}:${d}`}function B(i){let o=document.body,n,s;if(document.createRange&&window.getSelection){n=document.createRange(),s=window.getSelection(),s.removeAllRanges();try{n.selectNodeContents(i),s.addRange(n)}catch{n.selectNode(i),s.addRange(n)}}else o.createTextRange&&(n=o.createTextRange(),n.moveToElementText(i),n.select());document.execCommand("Copy"),document.getSelection().removeAllRanges()}const K={key:0,class:"copyed-msg"},Q={__name:"WorkingHoursCalculationNotice",props:{show_copyed:Boolean},setup(i){const o=i;return(n,s)=>o.show_copyed?(h(),f("div",K,"\u5DF2\u8907\u88FD\u5230\u526A\u8CBC\u7C3F")):x("",!0)}};var X="/joy-tools/assets/cuckoo-clock-trimmed.33833c85.mp3";const Z={class:"container"},j={class:"row"},ee={class:"col-12"},te={class:"upper-inner"},oe={id:"js-timer",class:"timer-wrap"},ae={class:"timer-text"},ne={class:"btn-wrap"},le=["data-type"],re={class:"group-wrap"},se={class:"form-group"},ie=t("label",{for:"chk-alert-sound"},"\u5E03\u7A40\u63D0\u793A\u97F3 (\u6BCF\u5C0F\u6642\u64AD\u653E)",-1),ue=t("source",{src:X,type:"audio/mpeg"},null,-1),ce=[ue],de={class:"form-group"},_e=t("label",{for:"chk-hour"},"\u6642\u6578\u9032\u4F4D\u70BA0.25\u7684\u500D\u6578 (\u704C\u6C3410\u5206\u9418\u4EE5\u5167)",-1),me={__name:"WorkingHoursCalculationHeader",props:E({timerData:Object},{alert_sound:{},alert_soundModifiers:{},hours_magic:{},hours_magicModifiers:{}}),emits:E(["eventWorkRecord","eventCopyTableData"],["update:alert_sound","update:hours_magic"]),setup(i,{expose:o,emit:n}){const s=i,c=n,u=N(i,"alert_sound"),d=N(i,"hours_magic");let _=v(null);o({alertPlayer:_});function m(){c("eventWorkRecord")}function $(){c("eventCopyTableData")}function k(){!u.value||(_.value.pause(),console.log("\u6253\u52FE"))}function w(){_.value.play(),console.log("\u8A66\u807D\u63D0\u793A\u97F3")}function a(){_.value.pause(),console.log("\u505C\u6B62\u64AD\u653E\u63D0\u793A\u97F3")}return(p,e)=>(h(),f("section",null,[t("div",Z,[t("div",j,[t("div",ee,[t("div",te,[t("div",oe,[t("span",ae,g(s.timerData.timer_text),1)]),t("div",ne,[t("button",{"data-type":s.timerData.timer_btn_type,onClick:e[0]||(e[0]=l=>m()),class:"text-btn"},g(s.timerData.timer_btn_text),9,le),t("button",{onClick:e[1]||(e[1]=l=>$()),class:"icon-btn copy-all","data-bs-container":"body","data-bs-toggle":"tooltip","data-bs-placement":"right",title:"\u8907\u88FD\u8868\u683C\u5230\u526A\u8CBC\u7C3F"})]),t("div",re,[t("fieldset",se,[D(t("input",{type:"checkbox",name:"chk-alert-sound",id:"chk-alert-sound","onUpdate:modelValue":e[2]||(e[2]=l=>u.value=l),onChange:e[3]||(e[3]=l=>k())},null,544),[[S,u.value]]),ie,t("button",{onClick:e[4]||(e[4]=l=>w()),class:"icon-btn play","data-bs-container":"body","data-bs-toggle":"tooltip","data-bs-placement":"top",title:"\u8A66\u807D"}),t("button",{onClick:e[5]||(e[5]=l=>a()),class:"icon-btn pause","data-bs-container":"body","data-bs-toggle":"tooltip","data-bs-placement":"top",title:"\u505C\u6B62\u64AD\u653E"}),t("audio",{loop:"",preload:"auto",ref_key:"alertPlayer",ref:_,class:"audio-player"},ce,512)]),t("fieldset",de,[D(t("input",{type:"checkbox",name:"chk-hour",id:"chk-hour","onUpdate:modelValue":e[6]||(e[6]=l=>d.value=l)},null,512),[[S,d.value]]),_e])])])])])])]))}},pe={class:"container"},ve={class:"row"},he={class:"col-12"},fe={class:"container-inner"},ge={class:"table-wrap"},be=t("table",{class:"table-header table table-hover",width:"100%"},[t("thead",null,[t("th",null,"\u65E5\u671F"),t("th",null,"\u6642\u6BB5"),t("th",null,"\u6642\u6578"),t("th",null,"\u5099\u8A3B"),t("th",null,"\u64CD\u4F5C")])],-1),ye={key:0},ke={key:1},$e={key:0,class:"comment-text"},we=["data-id","onUpdate:modelValue","onBlur"],xe=["onClick"],Ce=["onClick","disabled"],Te=t("td",{colspan:"2"},"\u7E3D\u8A08",-1),De=t("td",{colspan:"2"},null,-1),Re={__name:"WorkingHoursCalculationBody",props:{record_arr:Array,total_hour:Number,hours_magic:Boolean},emits:["eventEnableComment","eventRemoveRecord","eventCopyTrData"],setup(i,{expose:o,emit:n}){const s=i,c=n;let u=v(null);o({recordTable:u});let d=[];const _=function(a){a&&d.push({id:a.getAttribute("data-id"),el:a})};A(()=>{d=[]}),P(()=>{});function m(a,p){let e=a.r_start?a.r_start.split(" ")[0].split("-"):void 0,l=a.r_start?a.r_start.split(" ")[1].split(":"):void 0,r=a.r_end?a.r_end.split(" ")[1].split(":"):void 0;switch(p){case"start-date":return a.r_start?`${e[1]}/${e[2]}`:"";case"start-time":return a.r_start?`${l[0]}:${l[1]}`:"";case"end-time":return a.r_end?`${r[0]}:${r[1]}`:"";case"real-hours":return a.origin_hs?a.origin_hs.toFixed(2):"-";case"magic-hours":return a.magic_hs?a.magic_hs.toFixed(2):"-";case"number":return a?a.toFixed(2):"-"}}function $(a){c("eventRemoveRecord",a)}function k(a,p){c("eventEnableComment",a,p),U(()=>{!p||d.forEach(e=>{e.id==a&&e.el.focus()})})}function w(a){c("eventCopyTrData",a)}return(a,p)=>(h(),f("section",null,[t("div",pe,[t("div",ve,[t("div",he,[t("div",fe,[t("div",ge,[be,t("table",{class:"table-body table table-hover",ref_key:"recordTable",ref:u,width:"100%"},[t("tbody",null,[(h(!0),f(I,null,z(s.record_arr,(e,l)=>(h(),f("tr",{key:l},[t("td",null,g(m(e,"start-date")),1),t("td",null,g(m(e,"start-time"))+"~"+g(m(e,"end-time")),1),t("td",null,[s.hours_magic?(h(),f("span",ye,g(m(e,"magic-hours")),1)):x("",!0),s.hours_magic?x("",!0):(h(),f("span",ke,g(m(e,"real-hours")),1))]),t("td",null,[e.comment_editable?x("",!0):(h(),f("span",$e,g(e.r_comment),1)),e.comment_editable?D((h(),f("input",{key:1,type:"text","data-id":e.r_id,ref_for:!0,ref:_,"onUpdate:modelValue":r=>e.r_comment=r,onBlur:r=>k(e.r_id,!1)},null,40,we)),[[L,e.r_comment]]):x("",!0)]),t("td",null,[t("button",{onClick:r=>k(e.r_id,!0),class:"icon-btn edit"},null,8,xe),t("button",{onClick:r=>$(e.r_id),disabled:e.del_btn_enable,class:"icon-btn del"},null,8,Ce),t("button",{onClick:p[0]||(p[0]=r=>w(r)),class:"icon-btn copy"})])]))),128)),t("tr",null,[Te,t("td",null,g(m(s.total_hour,"number")),1),De])])],512)])])])])])]))}},Me={class:"container"},Ee={class:"row"},Ne={class:"col-12"},Se={class:"working-hours-calculation"},Ve={__name:"WorkingHoursCalculation",setup(i){const o=v([]),n=v({timer:null,timer_text:"00:00:00",timer_btn_type:"start",timer_btn_text:"Start"}),s=v(!1),c=v(!1),u=v(!1),d=v(0);O(()=>{let e=0;for(let l=0;l<o.value.length;l++)if(s.value){if(!o.value[l].magic_hs)return;e+=o.value[l].magic_hs}else{if(!o.value[l].origin_hs)return;e+=o.value[l].origin_hs}d.value=e});let _=v(null),m=v(null);Y(()=>{new q(document.body,{selector:"[data-bs-toggle='tooltip']"}),U(()=>{})});function $(){let e=J();switch(n.value.timer_btn_type){case"start":n.value.timer_text="00:00:01",n.value.timer=setInterval(()=>{let V=new Date(e),W=new Date,C=Math.ceil((W.getTime()-V.getTime())/1e3),H=b(Math.floor(C/60/60)%24),R=b(Math.floor(C/60)%60),M=b(Math.floor(C)%60);n.value.timer_text=`${H}:${R}:${M}`,console.log(n.value.timer_text),!!c.value&&R=="00"&&M=="00"&&(_.value.alertPlayer.play(),console.log("\u6574\u9EDE\u63D0\u793A\u97F3"))},1e3),n.value.timer_btn_text="Stop",n.value.timer_btn_type="end",o.value.push({r_id:o.value.length,r_start:e,r_end:void 0,r_comment:void 0,origin_hs:void 0,magic_hs:void 0,del_btn_enable:!0,comment_editable:!1});break;case"end":clearInterval(n.value.timer),n.value.timer=null,_.value.alertPlayer.pause(),console.log("\u95DC\u9589\u6574\u9EDE\u63D0\u793A\u97F3"),n.value.timer_text="00:00:00",n.value.timer_btn_text="Start",n.value.timer_btn_type="start";let r=(new Date(e).getTime()-new Date(o.value[o.value.length-1].r_start).getTime())/1e3/60/60,y=Math.ceil(r*4)/4,F=y-r<=.167?y:r;o.value[o.value.length-1].r_end=e,o.value[o.value.length-1].del_btn_enable=!1,o.value[o.value.length-1].origin_hs=r,o.value[o.value.length-1].magic_hs=F;break}}function k(e){!window.confirm("\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u7B46\u7D00\u9304\u55CE\uFF1F")||(o.value=o.value.filter(r=>r.r_id!=e))}function w(e,l){for(let r of o.value)r.r_id==e&&(r.comment_editable=l)}function a(){B(m.value.recordTable),u.value=!0,setTimeout(()=>{u.value=!1},1e3)}function p(e){let r=e.target.parentNode.parentNode.cloneNode(!0),y=document.createElement("table");y.append(r),document.body.append(y),B(y),u.value=!0,setTimeout(()=>{u.value=!1},1e3),y.remove()}return G(()=>{clearInterval(n.value.timer)}),(e,l)=>(h(),f("div",Me,[t("div",Ee,[t("div",Ne,[t("section",Se,[T(Q,{show_copyed:u.value},null,8,["show_copyed"]),T(me,{ref_key:"headerRef",ref:_,timerData:n.value,hours_magic:s.value,"onUpdate:hours_magic":l[0]||(l[0]=r=>s.value=r),alert_sound:c.value,"onUpdate:alert_sound":l[1]||(l[1]=r=>c.value=r),onEventWorkRecord:$,onEventCopyTableData:a},null,8,["timerData","hours_magic","alert_sound"]),T(Re,{ref_key:"bodyRef",ref:m,record_arr:o.value,total_hour:d.value,hours_magic:s.value,onEventEnableComment:w,onEventRemoveRecord:k,onEventCopyTrData:p},null,8,["record_arr","total_hour","hours_magic"])])])])]))}};export{Ve as default};
