import{a as p,c as v,x,m as E,j as R,e as f,b as e,t as b,g as T,v as S,y as I,z,F as U,k as L,h as O,n as Y,p as N,f as q,A as G,o as J,T as K,s as Q,d as H}from"./index.1792a1ae.js";import"./HackTimer.min.640bcee2.js";import{f as k}from"./useFormatNumber.010f5aee.js";function X(){let i=new Date,a=i.getFullYear(),n=k(i.getMonth()+1),l=k(i.getDate()),d=k(i.getHours()),g=k(i.getMinutes()),c=k(i.getSeconds());return`${a}-${n}-${l} ${d}:${g}:${c}`}function B(i){let a=document.body,n,l;if(document.createRange&&window.getSelection){n=document.createRange(),l=window.getSelection(),l.removeAllRanges();try{n.selectNodeContents(i),l.addRange(n)}catch{n.selectNode(i),l.addRange(n)}}else a.createTextRange&&(n=a.createTextRange(),n.moveToElementText(i),n.select());document.execCommand("Copy"),document.getSelection().removeAllRanges()}const Z={key:0,class:"copyed-msg"},ee={__name:"WorkingHoursCalculationNotice",props:{isShowCopyed:Boolean},setup(i){const a=i;return(n,l)=>a.isShowCopyed?(p(),v("div",Z,"\u5DF2\u8907\u88FD\u5230\u526A\u8CBC\u7C3F")):x("",!0)}};var te="/joy-tools/assets/cuckoo-clock-trimmed.33833c85.mp3";const oe={class:"container"},ae={class:"row"},ne={class:"col-12"},le={class:"upper-inner"},se={id:"js-timer",class:"timer-wrap"},re={class:"timer-text"},ie={class:"btn-wrap"},ue=["data-type"],de={class:"group-wrap"},ce={class:"form-group"},me=e("label",{for:"chk-alert-sound"},"\u5E03\u7A40\u63D0\u793A\u97F3 (\u6BCF\u5C0F\u6642\u64AD\u653E)",-1),_e=e("source",{src:te,type:"audio/mpeg"},null,-1),pe=[_e],ve={class:"form-group"},ge=e("label",{for:"chk-hour"},"\u9B54\u6CD5\u6642\u6578: \u6642\u6578\u9032\u4F4D\u70BA0.25\u7684\u500D\u6578 (\u704C\u6C3410\u5206\u9418\u4EE5\u5167)",-1),fe={class:"form-group"},he=e("label",{for:"fragmentary-mode"},"\u96F6\u788E\u6642\u9593\u6A21\u5F0F (\u9B54\u6CD5\u6642\u6578\u50C5\u97FF\u61C9\u5728\u52A0\u7E3D\u6642\u9593)",-1),ye={__name:"WorkingHoursCalculationHeader",props:E({timerData:Object},{isFragmentaryMode:{},isFragmentaryModeModifiers:{},isAlertSound:{},isAlertSoundModifiers:{},isHoursMagic:{},isHoursMagicModifiers:{}}),emits:E(["eventWorkRecord","eventCopyTableData"],["update:isFragmentaryMode","update:isAlertSound","update:isHoursMagic"]),setup(i,{expose:a,emit:n}){const l=i,d=n,g=R(i,"isFragmentaryMode"),c=R(i,"isAlertSound"),M=R(i,"isHoursMagic");let _=f(null);a({alertPlayer:_});function h(){d("eventWorkRecord")}function $(){d("eventCopyTableData")}function w(){!c.value||(_.value.pause(),console.log("\u6253\u52FE"))}function C(){_.value.play(),console.log("\u8A66\u807D\u63D0\u793A\u97F3")}function s(){_.value.pause(),console.log("\u505C\u6B62\u64AD\u653E\u63D0\u793A\u97F3")}return(y,t)=>(p(),v("section",null,[e("div",oe,[e("div",ae,[e("div",ne,[e("div",le,[e("div",se,[e("span",re,b(l.timerData.timer_text),1)]),e("div",ie,[e("button",{"data-type":l.timerData.timer_btn_type,onClick:t[0]||(t[0]=o=>h()),class:"text-btn"},b(l.timerData.timer_btn_text),9,ue),e("button",{onClick:t[1]||(t[1]=o=>$()),class:"icon-btn copy-all","data-bs-container":"body","data-bs-toggle":"tooltip","data-bs-placement":"right",title:"\u8907\u88FD\u8868\u683C\u5230\u526A\u8CBC\u7C3F"})]),e("div",de,[e("fieldset",ce,[T(e("input",{type:"checkbox",name:"chk-alert-sound",id:"chk-alert-sound","onUpdate:modelValue":t[2]||(t[2]=o=>c.value=o),onChange:t[3]||(t[3]=o=>w())},null,544),[[S,c.value]]),me,e("button",{onClick:t[4]||(t[4]=o=>C()),class:"icon-btn play","data-bs-container":"body","data-bs-toggle":"tooltip","data-bs-placement":"top",title:"\u8A66\u807D"}),e("button",{onClick:t[5]||(t[5]=o=>s()),class:"icon-btn pause","data-bs-container":"body","data-bs-toggle":"tooltip","data-bs-placement":"top",title:"\u505C\u6B62\u64AD\u653E"}),e("audio",{loop:"",preload:"auto",ref_key:"alertPlayer",ref:_,class:"audio-player"},pe,512)]),e("fieldset",ve,[T(e("input",{type:"checkbox",name:"chk-hour",id:"chk-hour","onUpdate:modelValue":t[6]||(t[6]=o=>M.value=o)},null,512),[[S,M.value]]),ge]),e("fieldset",fe,[T(e("input",{type:"checkbox",name:"fragmentary-mode",id:"fragmentary-mode","onUpdate:modelValue":t[7]||(t[7]=o=>g.value=o)},null,512),[[S,g.value]]),he])])])])])])]))}},be={class:"container"},ke={class:"row"},Me={class:"col-12"},$e={class:"container-inner"},we={class:"table-wrap"},Ce=e("table",{class:"table-header table table-hover",width:"100%"},[e("thead",null,[e("th",null,"\u65E5\u671F"),e("th",null,"\u6642\u6BB5"),e("th",null,"\u6642\u6578"),e("th",null,"\u5099\u8A3B"),e("th",null,"\u64CD\u4F5C")])],-1),xe={key:0},Te={key:0,class:"text-magic"},De={key:1},Re={key:0,class:"comment-text"},Se=["data-id","onUpdate:modelValue","onBlur"],He=["onClick"],Fe=["onClick","disabled"],Ae=e("td",{colspan:"2"},"\u7E3D\u8A08",-1),Ee=e("td",null,null,-1),Ue={__name:"WorkingHoursCalculationBody",props:{record_arr:Array,total_hour:Number,isFragmentaryMode:Boolean,isHoursMagic:Boolean},emits:["eventEnableComment","eventRemoveRecord","eventCopyTrData"],setup(i,{expose:a,emit:n}){const l=i,d=n;let g=f(null);a({recordTable:g});let c=[];const M=function(s){s&&c.push({id:s.getAttribute("data-id"),el:s})};I(()=>{c=[]}),z(()=>{});function _(s,y){let t=s?s.split(" ")[0].split("-"):void 0,o=s?s.split(" ")[1].split(":"):void 0;switch(y){case"yyyy":return t?t[0]:"";case"mmdd":return t?`${t[1]}/${t[2]}`:"";case"hhmm":return o?`${o[0]}:${o[1]}`:""}}function h(s){return s?s.toFixed(2):"-"}function $(s){d("eventRemoveRecord",s)}function w(s,y){d("eventEnableComment",s,y),N(()=>{!y||c.forEach(t=>{t.id==s&&t.el.focus()})})}function C(s){d("eventCopyTrData",s)}return(s,y)=>(p(),v("section",null,[e("div",be,[e("div",ke,[e("div",Me,[e("div",$e,[e("div",we,[Ce,e("table",{class:"table-body table table-hover",ref_key:"recordTable",ref:g,width:"100%"},[e("tbody",null,[(p(!0),v(U,null,L(l.record_arr,(t,o)=>(p(),v("tr",{key:o},[e("td",null,b(_(t.r_start,"mmdd")),1),e("td",null,b(_(t.r_start,"hhmm"))+"~"+b(_(t.r_end,"hhmm")),1),e("td",null,[l.isFragmentaryMode?(p(),v("span",xe,b(h(t.origin_hs)),1)):(p(),v(U,{key:1},[l.isHoursMagic?(p(),v("span",Te,b(h(t.magic_hs)),1)):x("",!0),l.isHoursMagic?x("",!0):(p(),v("span",De,b(h(t.origin_hs)),1))],64))]),e("td",null,[t.comment_editable?x("",!0):(p(),v("span",Re,b(t.r_comment),1)),t.comment_editable?T((p(),v("input",{key:1,type:"text","data-id":t.r_id,ref_for:!0,ref:M,"onUpdate:modelValue":r=>t.r_comment=r,onBlur:r=>w(t.r_id,!1)},null,40,Se)),[[O,t.r_comment]]):x("",!0)]),e("td",null,[e("button",{onClick:r=>w(t.r_id,!0),class:"icon-btn edit"},null,8,He),e("button",{onClick:r=>$(t.r_id),disabled:t.del_btn_enable,class:"icon-btn del"},null,8,Fe),e("button",{onClick:y[0]||(y[0]=r=>C(r)),class:"icon-btn copy"})])]))),128)),e("tr",null,[Ae,e("td",null,[e("span",{class:Y({"text-magic":l.isFragmentaryMode})},b(h(l.total_hour)),3)]),Ee])])],512)])])])])])]))}},Be={class:"container"},Ne={class:"row"},Ve={class:"col-12"},We={class:"working-hours-calculation"},ze={__name:"WorkingHoursCalculation",setup(i){const a=f([]),n=f({timer:null,timer_text:"00:00:00",timer_btn_type:"start",timer_btn_text:"Start"}),l=f(!1),d=f(!1),g=f(!1),c=f(!1),M=q(()=>(10/60).toFixed(3)),_=f(0);G(()=>{let o=0,r=0,u=0;for(let m=0;m<a.value.length;m++)a.value[m].magic_hs&&(u+=a.value[m].magic_hs),a.value[m].origin_hs&&(r+=a.value[m].origin_hs);l.value?d.value?o=Math.ceil(r*4)/4:o=r:d.value?o=u:o=r,_.value=o});let h=f(null),$=f(null);J(()=>{new K(document.body,{selector:"[data-bs-toggle='tooltip']"}),N(()=>{})});function w(){let o=X();switch(n.value.timer_btn_type){case"start":n.value.timer_text="00:00:01",n.value.timer=setInterval(()=>{let W=new Date(o),P=new Date,D=Math.ceil((P.getTime()-W.getTime())/1e3),j=k(Math.floor(D/60/60)%24),F=k(Math.floor(D/60)%60),A=k(Math.floor(D)%60);n.value.timer_text=`${j}:${F}:${A}`,console.log(n.value.timer_text),!!g.value&&F=="00"&&A=="00"&&(h.value.alertPlayer.play(),console.log("\u6574\u9EDE\u63D0\u793A\u97F3"))},1e3),n.value.timer_btn_text="Stop",n.value.timer_btn_type="end",a.value.push({r_id:a.value.length,r_start:o,r_end:void 0,r_comment:void 0,origin_hs:void 0,magic_hs:void 0,del_btn_enable:!0,comment_editable:!1});break;case"end":clearInterval(n.value.timer),n.value.timer=null,h.value.alertPlayer.pause(),console.log("\u95DC\u9589\u6574\u9EDE\u63D0\u793A\u97F3"),n.value.timer_text="00:00:00",n.value.timer_btn_text="Start",n.value.timer_btn_type="start";let u=(new Date(o).getTime()-new Date(a.value[a.value.length-1].r_start).getTime())/1e3/60/60,m=Math.ceil(u*4)/4,V=m-u<=M.value?m:u;a.value[a.value.length-1].r_end=o,a.value[a.value.length-1].del_btn_enable=!1,a.value[a.value.length-1].origin_hs=u,a.value[a.value.length-1].magic_hs=V;break}}function C(o){!window.confirm("\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u7B46\u7D00\u9304\u55CE\uFF1F")||(a.value=a.value.filter(u=>u.r_id!=o))}function s(o,r){for(let u of a.value)u.r_id==o&&(u.comment_editable=r)}function y(){B($.value.recordTable),c.value=!0,setTimeout(()=>{c.value=!1},1e3)}function t(o){let u=o.target.parentNode.parentNode.cloneNode(!0),m=document.createElement("table");m.append(u),document.body.append(m),B(m),c.value=!0,setTimeout(()=>{c.value=!1},1e3),m.remove()}return Q(()=>{clearInterval(n.value.timer)}),(o,r)=>(p(),v("div",Be,[e("div",Ne,[e("div",Ve,[e("section",We,[H(ee,{isShowCopyed:c.value},null,8,["isShowCopyed"]),H(ye,{ref_key:"headerRef",ref:h,timerData:n.value,isFragmentaryMode:l.value,"onUpdate:isFragmentaryMode":r[0]||(r[0]=u=>l.value=u),isHoursMagic:d.value,"onUpdate:isHoursMagic":r[1]||(r[1]=u=>d.value=u),isAlertSound:g.value,"onUpdate:isAlertSound":r[2]||(r[2]=u=>g.value=u),onEventWorkRecord:w,onEventCopyTableData:y},null,8,["timerData","isFragmentaryMode","isHoursMagic","isAlertSound"]),H(Ue,{ref_key:"bodyRef",ref:$,record_arr:a.value,total_hour:_.value,isFragmentaryMode:l.value,isHoursMagic:d.value,onEventEnableComment:s,onEventRemoveRecord:C,onEventCopyTrData:t},null,8,["record_arr","total_hour","isFragmentaryMode","isHoursMagic"])])])])]))}};export{ze as default};
