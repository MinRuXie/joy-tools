import{a as p,c as v,x as C,m as A,j as D,e as h,b as e,t as y,g as x,v as R,y as I,z,F as E,k as L,h as O,p as U,A as Y,o as q,T as G,s as J,d as S}from"./index.0f58f72f.js";import"./HackTimer.min.640bcee2.js";import{f as b}from"./useFormatNumber.15502b88.js";function K(){let i=new Date,a=i.getFullYear(),l=b(i.getMonth()+1),r=b(i.getDate()),c=b(i.getHours()),g=b(i.getMinutes()),_=b(i.getSeconds());return`${a}-${l}-${r} ${c}:${g}:${_}`}function N(i){let a=document.body,l,r;if(document.createRange&&window.getSelection){l=document.createRange(),r=window.getSelection(),r.removeAllRanges();try{l.selectNodeContents(i),r.addRange(l)}catch{l.selectNode(i),r.addRange(l)}}else a.createTextRange&&(l=a.createTextRange(),l.moveToElementText(i),l.select());document.execCommand("Copy"),document.getSelection().removeAllRanges()}const Q={key:0,class:"copyed-msg"},X={__name:"WorkingHoursCalculationNotice",props:{isShowCopyed:Boolean},setup(i){const a=i;return(l,r)=>a.isShowCopyed?(p(),v("div",Q,"\u5DF2\u8907\u88FD\u5230\u526A\u8CBC\u7C3F")):C("",!0)}};var Z="/joy-tools/assets/cuckoo-clock-trimmed.33833c85.mp3";const j={class:"container"},ee={class:"row"},te={class:"col-12"},oe={class:"upper-inner"},ae={id:"js-timer",class:"timer-wrap"},ne={class:"timer-text"},le={class:"btn-wrap"},se=["data-type"],re={class:"group-wrap"},ie={class:"form-group"},ue=e("label",{for:"chk-alert-sound"},"\u5E03\u7A40\u63D0\u793A\u97F3 (\u6BCF\u5C0F\u6642\u64AD\u653E)",-1),de=e("source",{src:Z,type:"audio/mpeg"},null,-1),ce=[de],_e={class:"form-group"},me=e("label",{for:"chk-hour"},"\u9B54\u6CD5\u6642\u6578: \u6642\u6578\u9032\u4F4D\u70BA0.25\u7684\u500D\u6578 (\u704C\u6C3410\u5206\u9418\u4EE5\u5167)",-1),pe={class:"form-group"},ve=e("label",{for:"fragmentary-mode"},"\u96F6\u788E\u6642\u9593\u6A21\u5F0F (\u9B54\u6CD5\u6642\u6578\u50C5\u97FF\u61C9\u5728\u52A0\u7E3D\u6642\u9593)",-1),ge={__name:"WorkingHoursCalculationHeader",props:A({timerData:Object},{isFragmentaryMode:{},isFragmentaryModeModifiers:{},isAlertSound:{},isAlertSoundModifiers:{},isHoursMagic:{},isHoursMagicModifiers:{}}),emits:A(["eventWorkRecord","eventCopyTableData"],["update:isFragmentaryMode","update:isAlertSound","update:isHoursMagic"]),setup(i,{expose:a,emit:l}){const r=i,c=l,g=D(i,"isFragmentaryMode"),_=D(i,"isAlertSound"),k=D(i,"isHoursMagic");let d=h(null);a({alertPlayer:d});function $(){c("eventWorkRecord")}function M(){c("eventCopyTableData")}function w(){!_.value||(d.value.pause(),console.log("\u6253\u52FE"))}function n(){d.value.play(),console.log("\u8A66\u807D\u63D0\u793A\u97F3")}function f(){d.value.pause(),console.log("\u505C\u6B62\u64AD\u653E\u63D0\u793A\u97F3")}return(s,t)=>(p(),v("section",null,[e("div",j,[e("div",ee,[e("div",te,[e("div",oe,[e("div",ae,[e("span",ne,y(r.timerData.timer_text),1)]),e("div",le,[e("button",{"data-type":r.timerData.timer_btn_type,onClick:t[0]||(t[0]=o=>$()),class:"text-btn"},y(r.timerData.timer_btn_text),9,se),e("button",{onClick:t[1]||(t[1]=o=>M()),class:"icon-btn copy-all","data-bs-container":"body","data-bs-toggle":"tooltip","data-bs-placement":"right",title:"\u8907\u88FD\u8868\u683C\u5230\u526A\u8CBC\u7C3F"})]),e("div",re,[e("fieldset",ie,[x(e("input",{type:"checkbox",name:"chk-alert-sound",id:"chk-alert-sound","onUpdate:modelValue":t[2]||(t[2]=o=>_.value=o),onChange:t[3]||(t[3]=o=>w())},null,544),[[R,_.value]]),ue,e("button",{onClick:t[4]||(t[4]=o=>n()),class:"icon-btn play","data-bs-container":"body","data-bs-toggle":"tooltip","data-bs-placement":"top",title:"\u8A66\u807D"}),e("button",{onClick:t[5]||(t[5]=o=>f()),class:"icon-btn pause","data-bs-container":"body","data-bs-toggle":"tooltip","data-bs-placement":"top",title:"\u505C\u6B62\u64AD\u653E"}),e("audio",{loop:"",preload:"auto",ref_key:"alertPlayer",ref:d,class:"audio-player"},ce,512)]),e("fieldset",_e,[x(e("input",{type:"checkbox",name:"chk-hour",id:"chk-hour","onUpdate:modelValue":t[6]||(t[6]=o=>k.value=o)},null,512),[[R,k.value]]),me]),e("fieldset",pe,[x(e("input",{type:"checkbox",name:"fragmentary-mode",id:"fragmentary-mode","onUpdate:modelValue":t[7]||(t[7]=o=>g.value=o)},null,512),[[R,g.value]]),ve])])])])])])]))}},fe={class:"container"},he={class:"row"},ye={class:"col-12"},be={class:"container-inner"},ke={class:"table-wrap"},$e=e("table",{class:"table-header table table-hover",width:"100%"},[e("thead",null,[e("th",null,"\u65E5\u671F"),e("th",null,"\u6642\u6BB5"),e("th",null,"\u6642\u6578"),e("th",null,"\u5099\u8A3B"),e("th",null,"\u64CD\u4F5C")])],-1),Me={key:0},we={key:0},Ce={key:1},xe={key:0,class:"comment-text"},Te=["data-id","onUpdate:modelValue","onBlur"],De=["onClick"],Re=["onClick","disabled"],Se=e("td",{colspan:"2"},"\u7E3D\u8A08",-1),Fe=e("td",{colspan:"2"},null,-1),He={__name:"WorkingHoursCalculationBody",props:{record_arr:Array,total_hour:Number,isFragmentaryMode:Boolean,isHoursMagic:Boolean},emits:["eventEnableComment","eventRemoveRecord","eventCopyTrData"],setup(i,{expose:a,emit:l}){const r=i,c=l;let g=h(null);a({recordTable:g});let _=[];const k=function(n){n&&_.push({id:n.getAttribute("data-id"),el:n})};I(()=>{_=[]}),z(()=>{});function d(n,f){let s=n.r_start?n.r_start.split(" ")[0].split("-"):void 0,t=n.r_start?n.r_start.split(" ")[1].split(":"):void 0,o=n.r_end?n.r_end.split(" ")[1].split(":"):void 0;switch(f){case"start-date":return n.r_start?`${s[1]}/${s[2]}`:"";case"start-time":return n.r_start?`${t[0]}:${t[1]}`:"";case"end-time":return n.r_end?`${o[0]}:${o[1]}`:"";case"real-hours":return n.origin_hs?n.origin_hs.toFixed(2):"-";case"magic-hours":return n.magic_hs?n.magic_hs.toFixed(2):"-";case"number":return n?n.toFixed(2):"-"}}function $(n){c("eventRemoveRecord",n)}function M(n,f){c("eventEnableComment",n,f),U(()=>{!f||_.forEach(s=>{s.id==n&&s.el.focus()})})}function w(n){c("eventCopyTrData",n)}return(n,f)=>(p(),v("section",null,[e("div",fe,[e("div",he,[e("div",ye,[e("div",be,[e("div",ke,[$e,e("table",{class:"table-body table table-hover",ref_key:"recordTable",ref:g,width:"100%"},[e("tbody",null,[(p(!0),v(E,null,L(r.record_arr,(s,t)=>(p(),v("tr",{key:t},[e("td",null,y(d(s,"start-date")),1),e("td",null,y(d(s,"start-time"))+"~"+y(d(s,"end-time")),1),e("td",null,[r.isFragmentaryMode?(p(),v("span",Me,y(d(s,"real-hours")),1)):(p(),v(E,{key:1},[r.isHoursMagic?(p(),v("span",we,y(d(s,"magic-hours")),1)):C("",!0),r.isHoursMagic?C("",!0):(p(),v("span",Ce,y(d(s,"real-hours")),1))],64))]),e("td",null,[s.comment_editable?C("",!0):(p(),v("span",xe,y(s.r_comment),1)),s.comment_editable?x((p(),v("input",{key:1,type:"text","data-id":s.r_id,ref_for:!0,ref:k,"onUpdate:modelValue":o=>s.r_comment=o,onBlur:o=>M(s.r_id,!1)},null,40,Te)),[[O,s.r_comment]]):C("",!0)]),e("td",null,[e("button",{onClick:o=>M(s.r_id,!0),class:"icon-btn edit"},null,8,De),e("button",{onClick:o=>$(s.r_id),disabled:s.del_btn_enable,class:"icon-btn del"},null,8,Re),e("button",{onClick:f[0]||(f[0]=o=>w(o)),class:"icon-btn copy"})])]))),128)),e("tr",null,[Se,e("td",null,y(d(r.total_hour,"number")),1),Fe])])],512)])])])])])]))}},Ae={class:"container"},Ee={class:"row"},Ne={class:"col-12"},Ue={class:"working-hours-calculation"},Pe={__name:"WorkingHoursCalculation",setup(i){const a=h([]),l=h({timer:null,timer_text:"00:00:00",timer_btn_type:"start",timer_btn_text:"Start"}),r=h(!1),c=h(!1),g=h(!1),_=h(!1),k=h(0);Y(()=>{let t=0,o=0,u=0;for(let m=0;m<a.value.length;m++)a.value[m].magic_hs&&(u+=a.value[m].magic_hs),a.value[m].origin_hs&&(o+=a.value[m].origin_hs);r.value?c.value?t=Math.ceil(o*4)/4:t=o:c.value?t=u:t=o,k.value=t});let d=h(null),$=h(null);q(()=>{new G(document.body,{selector:"[data-bs-toggle='tooltip']"}),U(()=>{})});function M(){let t=K();switch(l.value.timer_btn_type){case"start":l.value.timer_text="00:00:01",l.value.timer=setInterval(()=>{let V=new Date(t),W=new Date,T=Math.ceil((W.getTime()-V.getTime())/1e3),P=b(Math.floor(T/60/60)%24),F=b(Math.floor(T/60)%60),H=b(Math.floor(T)%60);l.value.timer_text=`${P}:${F}:${H}`,console.log(l.value.timer_text),!!g.value&&F=="00"&&H=="00"&&(d.value.alertPlayer.play(),console.log("\u6574\u9EDE\u63D0\u793A\u97F3"))},1e3),l.value.timer_btn_text="Stop",l.value.timer_btn_type="end",a.value.push({r_id:a.value.length,r_start:t,r_end:void 0,r_comment:void 0,origin_hs:void 0,magic_hs:void 0,del_btn_enable:!0,comment_editable:!1});break;case"end":clearInterval(l.value.timer),l.value.timer=null,d.value.alertPlayer.pause(),console.log("\u95DC\u9589\u6574\u9EDE\u63D0\u793A\u97F3"),l.value.timer_text="00:00:00",l.value.timer_btn_text="Start",l.value.timer_btn_type="start";let u=(new Date(t).getTime()-new Date(a.value[a.value.length-1].r_start).getTime())/1e3/60/60,m=Math.ceil(u*4)/4,B=m-u<=.167?m:u;a.value[a.value.length-1].r_end=t,a.value[a.value.length-1].del_btn_enable=!1,a.value[a.value.length-1].origin_hs=u,a.value[a.value.length-1].magic_hs=B;break}}function w(t){!window.confirm("\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u7B46\u7D00\u9304\u55CE\uFF1F")||(a.value=a.value.filter(u=>u.r_id!=t))}function n(t,o){for(let u of a.value)u.r_id==t&&(u.comment_editable=o)}function f(){N($.value.recordTable),_.value=!0,setTimeout(()=>{_.value=!1},1e3)}function s(t){let u=t.target.parentNode.parentNode.cloneNode(!0),m=document.createElement("table");m.append(u),document.body.append(m),N(m),_.value=!0,setTimeout(()=>{_.value=!1},1e3),m.remove()}return J(()=>{clearInterval(l.value.timer)}),(t,o)=>(p(),v("div",Ae,[e("div",Ee,[e("div",Ne,[e("section",Ue,[S(X,{isShowCopyed:_.value},null,8,["isShowCopyed"]),S(ge,{ref_key:"headerRef",ref:d,timerData:l.value,isFragmentaryMode:r.value,"onUpdate:isFragmentaryMode":o[0]||(o[0]=u=>r.value=u),isHoursMagic:c.value,"onUpdate:isHoursMagic":o[1]||(o[1]=u=>c.value=u),isAlertSound:g.value,"onUpdate:isAlertSound":o[2]||(o[2]=u=>g.value=u),onEventWorkRecord:M,onEventCopyTableData:f},null,8,["timerData","isFragmentaryMode","isHoursMagic","isAlertSound"]),S(He,{ref_key:"bodyRef",ref:$,record_arr:a.value,total_hour:k.value,isFragmentaryMode:r.value,isHoursMagic:c.value,onEventEnableComment:n,onEventRemoveRecord:w,onEventCopyTrData:s},null,8,["record_arr","total_hour","isFragmentaryMode","isHoursMagic"])])])])]))}};export{Pe as default};
