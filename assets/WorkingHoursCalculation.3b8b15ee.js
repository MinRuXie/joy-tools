import{a as p,c as v,x,m as E,j as R,e as f,b as e,t as b,g as T,v as S,y as I,z as K,F as N,k as z,h as L,A as O,n as Y,p as U,f as q,B as G,o as J,T as Q,s as X,d as H}from"./index.e442d8ee.js";import"./HackTimer.min.640bcee2.js";import{f as k}from"./useFormatNumber.010f5aee.js";function Z(){let i=new Date,a=i.getFullYear(),n=k(i.getMonth()+1),l=k(i.getDate()),u=k(i.getHours()),g=k(i.getMinutes()),c=k(i.getSeconds());return`${a}-${n}-${l} ${u}:${g}:${c}`}function B(i){let a=document.body,n,l;if(document.createRange&&window.getSelection){n=document.createRange(),l=window.getSelection(),l.removeAllRanges();try{n.selectNodeContents(i),l.addRange(n)}catch{n.selectNode(i),l.addRange(n)}}else a.createTextRange&&(n=a.createTextRange(),n.moveToElementText(i),n.select());document.execCommand("Copy"),document.getSelection().removeAllRanges()}const ee={key:0,class:"copyed-msg"},te={__name:"WorkingHoursCalculationNotice",props:{isShowCopyed:Boolean},setup(i){const a=i;return(n,l)=>a.isShowCopyed?(p(),v("div",ee,"\u5DF2\u8907\u88FD\u5230\u526A\u8CBC\u7C3F")):x("",!0)}};var oe="/joy-tools/assets/cuckoo-clock-trimmed.33833c85.mp3";const ae={class:"container"},ne={class:"row"},se={class:"col-12"},le={class:"upper-inner"},re={id:"js-timer",class:"timer-wrap"},ie={class:"timer-text"},de={class:"btn-wrap"},ue=["data-type"],ce={class:"group-wrap"},me={class:"form-group"},_e=e("label",{for:"chk-alert-sound"},"\u5E03\u7A40\u63D0\u793A\u97F3 (\u6BCF\u5C0F\u6642\u64AD\u653E)",-1),pe=e("source",{src:oe,type:"audio/mpeg"},null,-1),ve=[pe],ge={class:"form-group"},fe=e("label",{for:"chk-hour"},"\u9B54\u6CD5\u6642\u6578: \u6642\u6578\u9032\u4F4D\u70BA0.25\u7684\u500D\u6578 (\u704C\u6C3410\u5206\u9418\u4EE5\u5167)",-1),he={class:"form-group"},ye=e("label",{for:"fragmentary-mode"},"\u96F6\u788E\u6642\u9593\u6A21\u5F0F (\u9B54\u6CD5\u6642\u6578\u50C5\u97FF\u61C9\u5728\u52A0\u7E3D\u6642\u9593)",-1),be={__name:"WorkingHoursCalculationHeader",props:E({timerData:Object},{isFragmentaryMode:{},isFragmentaryModeModifiers:{},isAlertSound:{},isAlertSoundModifiers:{},isHoursMagic:{},isHoursMagicModifiers:{}}),emits:E(["eventWorkRecord","eventCopyTableData"],["update:isFragmentaryMode","update:isAlertSound","update:isHoursMagic"]),setup(i,{expose:a,emit:n}){const l=i,u=n,g=R(i,"isFragmentaryMode"),c=R(i,"isAlertSound"),M=R(i,"isHoursMagic");let _=f(null);a({alertPlayer:_});function h(){u("eventWorkRecord")}function w(){u("eventCopyTableData")}function $(){!c.value||(_.value.pause(),console.log("\u6253\u52FE"))}function C(){_.value.play(),console.log("\u8A66\u807D\u63D0\u793A\u97F3")}function r(){_.value.pause(),console.log("\u505C\u6B62\u64AD\u653E\u63D0\u793A\u97F3")}return(y,t)=>(p(),v("section",null,[e("div",ae,[e("div",ne,[e("div",se,[e("div",le,[e("div",re,[e("span",ie,b(l.timerData.timer_text),1)]),e("div",de,[e("button",{"data-type":l.timerData.timer_btn_type,onClick:t[0]||(t[0]=o=>h()),class:"text-btn"},b(l.timerData.timer_btn_text),9,ue),e("button",{onClick:t[1]||(t[1]=o=>w()),class:"icon-btn copy-all","data-bs-container":"body","data-bs-toggle":"tooltip","data-bs-placement":"right",title:"\u8907\u88FD\u8868\u683C\u5230\u526A\u8CBC\u7C3F"})]),e("div",ce,[e("fieldset",me,[T(e("input",{type:"checkbox",name:"chk-alert-sound",id:"chk-alert-sound","onUpdate:modelValue":t[2]||(t[2]=o=>c.value=o),onChange:t[3]||(t[3]=o=>$())},null,544),[[S,c.value]]),_e,e("button",{onClick:t[4]||(t[4]=o=>C()),class:"icon-btn play","data-bs-container":"body","data-bs-toggle":"tooltip","data-bs-placement":"top",title:"\u8A66\u807D"}),e("button",{onClick:t[5]||(t[5]=o=>r()),class:"icon-btn pause","data-bs-container":"body","data-bs-toggle":"tooltip","data-bs-placement":"top",title:"\u505C\u6B62\u64AD\u653E"}),e("audio",{loop:"",preload:"auto",ref_key:"alertPlayer",ref:_,class:"audio-player"},ve,512)]),e("fieldset",ge,[T(e("input",{type:"checkbox",name:"chk-hour",id:"chk-hour","onUpdate:modelValue":t[6]||(t[6]=o=>M.value=o)},null,512),[[S,M.value]]),fe]),e("fieldset",he,[T(e("input",{type:"checkbox",name:"fragmentary-mode",id:"fragmentary-mode","onUpdate:modelValue":t[7]||(t[7]=o=>g.value=o)},null,512),[[S,g.value]]),ye])])])])])])]))}},ke={class:"container"},$e={class:"row"},Me={class:"col-12"},we={class:"container-inner"},Ce={class:"table-wrap"},xe=e("thead",null,[e("th",{width:"20%"},"\u65E5\u671F"),e("th",{width:"25%"},"\u6642\u6BB5"),e("th",{width:"20%"},"\u6642\u6578"),e("th",null,"\u5099\u8A3B")],-1),Te={key:0},De={key:0,class:"text-magic"},Re={key:1},Se={class:"other-wrap"},He={class:"remark-wrap"},Fe={key:0,class:"comment-text"},Ae=["data-id","onUpdate:modelValue","onBlur","onKeyup"],Ee={class:"operate-wrap"},Ne=["onClick"],Be=["onClick","disabled"],Ue=e("td",null,"\u7E3D\u8A08",-1),Ve=e("td",null,null,-1),We=e("td",null,null,-1),Pe={__name:"WorkingHoursCalculationBody",props:{record_arr:Array,total_hour:Number,isFragmentaryMode:Boolean,isHoursMagic:Boolean},emits:["eventEnableComment","eventRemoveRecord","eventCopyTrData"],setup(i,{expose:a,emit:n}){const l=i,u=n;let g=f(null);a({recordTable:g});let c=[];const M=function(r){r&&c.push({id:r.getAttribute("data-id"),el:r})};I(()=>{c=[]}),K(()=>{});function _(r,y){let t=r?r.split(" ")[0].split("-"):void 0,o=r?r.split(" ")[1].split(":"):void 0;switch(y){case"yyyy":return t?t[0]:"";case"mmdd":return t?`${t[1]}/${t[2]}`:"";case"hhmm":return o?`${o[0]}:${o[1]}`:""}}function h(r){return r?r.toFixed(2):"-"}function w(r){u("eventRemoveRecord",r)}function $(r,y){u("eventEnableComment",r,y),U(()=>{!y||c.forEach(t=>{t.id==r&&t.el.focus()})})}function C(r){u("eventCopyTrData",r)}return(r,y)=>(p(),v("section",null,[e("div",ke,[e("div",$e,[e("div",Me,[e("div",we,[e("div",Ce,[e("table",{ref_key:"recordTable",ref:g,class:"table-body table table-hover",width:"100%"},[xe,e("tbody",null,[(p(!0),v(N,null,z(l.record_arr,(t,o)=>(p(),v("tr",{key:o},[e("td",null,b(_(t.r_start,"mmdd")),1),e("td",null,b(_(t.r_start,"hhmm"))+"~"+b(_(t.r_end,"hhmm")),1),e("td",null,[l.isFragmentaryMode?(p(),v("span",Te,b(h(t.origin_hs)),1)):(p(),v(N,{key:1},[l.isHoursMagic?(p(),v("span",De,b(h(t.magic_hs)),1)):x("",!0),l.isHoursMagic?x("",!0):(p(),v("span",Re,b(h(t.origin_hs)),1))],64))]),e("td",null,[e("div",Se,[e("div",He,[t.comment_editable?x("",!0):(p(),v("span",Fe,b(t.r_comment),1)),t.comment_editable?T((p(),v("input",{key:1,type:"text",class:"comment-input","data-id":t.r_id,ref_for:!0,ref:M,"onUpdate:modelValue":s=>t.r_comment=s,onBlur:s=>$(t.r_id,!1),onKeyup:O(s=>$(t.r_id,!1),["enter"])},null,40,Ae)),[[L,t.r_comment]]):x("",!0)]),e("div",Ee,[e("button",{onClick:s=>$(t.r_id,!0),class:"icon-btn edit"},null,8,Ne),e("button",{onClick:s=>w(t.r_id),disabled:t.del_btn_enable,class:"icon-btn del"},null,8,Be),e("button",{onClick:y[0]||(y[0]=s=>C(s)),class:"icon-btn copy"})])])])]))),128)),e("tr",null,[Ue,Ve,e("td",null,[e("span",{class:Y({"text-magic":l.isFragmentaryMode})},b(h(l.total_hour)),3)]),We])])],512)])])])])])]))}},je={class:"container"},Ie={class:"row"},Ke={class:"col-12"},ze={class:"working-hours-calculation"},qe={__name:"WorkingHoursCalculation",setup(i){const a=f([]),n=f({timer:null,timer_text:"00:00:00",timer_btn_type:"start",timer_btn_text:"Start"}),l=f(!1),u=f(!1),g=f(!1),c=f(!1),M=q(()=>(10/60).toFixed(3)),_=f(0);G(()=>{let o=0,s=0,d=0;for(let m=0;m<a.value.length;m++)a.value[m].magic_hs&&(d+=a.value[m].magic_hs),a.value[m].origin_hs&&(s+=a.value[m].origin_hs);l.value?u.value?o=Math.ceil(s*4)/4:o=s:u.value?o=d:o=s,_.value=o});let h=f(null),w=f(null);J(()=>{new Q(document.body,{selector:"[data-bs-toggle='tooltip']"}),U(()=>{})});function $(){let o=Z();switch(n.value.timer_btn_type){case"start":n.value.timer_text="00:00:01",n.value.timer=setInterval(()=>{let W=new Date(o),P=new Date,D=Math.ceil((P.getTime()-W.getTime())/1e3),j=k(Math.floor(D/60/60)%24),F=k(Math.floor(D/60)%60),A=k(Math.floor(D)%60);n.value.timer_text=`${j}:${F}:${A}`,console.log(n.value.timer_text),!!g.value&&F=="00"&&A=="00"&&(h.value.alertPlayer.play(),console.log("\u6574\u9EDE\u63D0\u793A\u97F3"))},1e3),n.value.timer_btn_text="Stop",n.value.timer_btn_type="end",a.value.push({r_id:a.value.length,r_start:o,r_end:void 0,r_comment:void 0,origin_hs:void 0,magic_hs:void 0,del_btn_enable:!0,comment_editable:!1});break;case"end":clearInterval(n.value.timer),n.value.timer=null,h.value.alertPlayer.pause(),console.log("\u95DC\u9589\u6574\u9EDE\u63D0\u793A\u97F3"),n.value.timer_text="00:00:00",n.value.timer_btn_text="Start",n.value.timer_btn_type="start";let d=(new Date(o).getTime()-new Date(a.value[a.value.length-1].r_start).getTime())/1e3/60/60,m=Math.ceil(d*4)/4,V=m-d<=M.value?m:d;a.value[a.value.length-1].r_end=o,a.value[a.value.length-1].del_btn_enable=!1,a.value[a.value.length-1].origin_hs=d,a.value[a.value.length-1].magic_hs=V;break}}function C(o){!window.confirm("\u78BA\u5B9A\u8981\u522A\u9664\u6B64\u7B46\u7D00\u9304\u55CE\uFF1F")||(a.value=a.value.filter(d=>d.r_id!=o))}function r(o,s){for(let d of a.value)d.r_id==o&&(d.comment_editable=s)}function y(){B(w.value.recordTable),c.value=!0,setTimeout(()=>{c.value=!1},1e3)}function t(o){let d=o.target.parentNode.parentNode.parentNode.parentNode.cloneNode(!0),m=document.createElement("table");m.append(d),document.body.append(m),B(m),c.value=!0,setTimeout(()=>{c.value=!1},1e3),m.remove()}return X(()=>{clearInterval(n.value.timer)}),(o,s)=>(p(),v("div",je,[e("div",Ie,[e("div",Ke,[e("section",ze,[H(te,{isShowCopyed:c.value},null,8,["isShowCopyed"]),H(be,{ref_key:"headerRef",ref:h,timerData:n.value,isFragmentaryMode:l.value,"onUpdate:isFragmentaryMode":s[0]||(s[0]=d=>l.value=d),isHoursMagic:u.value,"onUpdate:isHoursMagic":s[1]||(s[1]=d=>u.value=d),isAlertSound:g.value,"onUpdate:isAlertSound":s[2]||(s[2]=d=>g.value=d),onEventWorkRecord:$,onEventCopyTableData:y},null,8,["timerData","isFragmentaryMode","isHoursMagic","isAlertSound"]),H(Pe,{ref_key:"bodyRef",ref:w,record_arr:a.value,total_hour:_.value,isFragmentaryMode:l.value,isHoursMagic:u.value,onEventEnableComment:r,onEventRemoveRecord:C,onEventCopyTrData:t},null,8,["record_arr","total_hour","isFragmentaryMode","isHoursMagic"])])])])]))}};export{qe as default};
